(()=>{"use strict";var e=function(e,t,n,a){return new(n||(n=Promise))((function(o,s){function i(e){try{r(a.next(e))}catch(e){s(e)}}function d(e){try{r(a.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,d)}r((a=a.apply(e,t||[])).next())}))};class t{constructor(e,t){this.finishTimeMS=0,this.id=-1;const n=(new Date).getTime();this.finishTimeMS=n+t,this.id=setTimeout(e,t)}getRemainingTime(){return this.finishTimeMS-(new Date).getTime()}cancel(){clearTimeout(this.id)}}var n=function(e,t,n,a){return new(n||(n=Promise))((function(o,s){function i(e){try{r(a.next(e))}catch(e){s(e)}}function d(e){try{r(a.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,d)}r((a=a.apply(e,t||[])).next())}))};class a{constructor(){this.i=0,this.salt=0}randomUUID(e){return n(this,void 0,void 0,(function*(){void 0===e&&(e=[{n:8,charset:"alphanumerical"},{n:4,charset:"alphanumerical"},{n:4,charset:"alphanumerical"},{n:4,charset:"alphanumerical"},{n:12,charset:"alphanumerical"}]);let t="";for(let n=0;n<e.length;n++){const o=e[n].n,s=a.alphabets[e[n].charset];for(let e=0;e<o;e++){let e=yield this.random(0,s.length-1);t+=s.charAt(Math.round(e))}t+="-"}return Promise.resolve(t.slice(0,-1))}))}setSeed(e){return n(this,void 0,void 0,(function*(){const t=(new TextEncoder).encode(e),n=yield crypto.subtle.digest("SHA-1",t);return this.hash=Array.from(new Uint8Array(n)),this.seed=e,this.i=0,this.salt=0,Promise.resolve()}))}random(e=0,t=1){return n(this,void 0,void 0,(function*(){return void 0===this.hash?Promise.reject(new Error("Seed is blank. Have you called setSeed() before random()?")):t-e>255?Promise.reject(new Error("This random number generator cannot comfortably produce numbers for ranges greater than 8 bits of entropy (ranges containing >256 numbers)")):(this.i>=this.hash.length&&(this.i=0,this.salt++,yield this.setSeed(this.seed+this.salt.toString())),Promise.resolve((this.hash[this.i++]-0)*(t-(n=e))/255+n));var n}))}}a.alphabets={alphanumerical:"abcdefghijklmnopqrstuvwxyz0123456789",alpha:"abcdefghijklmnopqrstuvwxyz"};var o=function(e,t,n,a){return new(n||(n=Promise))((function(o,s){function i(e){try{r(a.next(e))}catch(e){s(e)}}function d(e){try{r(a.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,d)}r((a=a.apply(e,t||[])).next())}))};function s(){const e=new URL(document.URL);return"file:"===e.protocol||"localhost"===e.host||"127.0.0.1"===e.host}function i(e,t="Assertion failed"){if(!e&&s())throw new Error(t)}function d(e){const t=document.querySelector(e);return i(null!==t,`Failed to find a DOM element matching selector "${e}"`),t}const r="https://www.reddit.com",l=d("#posts"),c=d("section.reddit-post");let u=["#c24332","#2e303f","#63948c","#ebe6d1","#517c63","#4c525f","#371d31","#f95950","#023246","#2e77ae","#0d2137","#ff8e2b"],h=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];const m=d(".menu"),p=d(".menu-selector");m.addEventListener("click",(()=>{p.classList.toggle("hidden")}));const f=new class{constructor(e=0){this.faces=[],this.promises=[],this.lastTask=null,this.currentID=0,this.throttleMS=1e3;for(let t=0;t<e;t++)this.sideload()}getFaces(){return this.faces}all(){return e(this,void 0,void 0,(function*(){return Promise.all(this.promises)}))}sideload(){return e(this,void 0,void 0,(function*(){let e=0;if(null!==this.lastTask){const t=Math.max(0,this.lastTask.getRemainingTime());e=t+this.throttleMS,e<0&&(e=0)}const n=new Promise(((n,a)=>{const o=this.currentID;this.lastTask=new t((()=>{let e=document.createElement("img");e.src=`https://thispersondoesnotexist.com/image?cnh=${o}`,e.addEventListener("load",(()=>{this.faces.push(e),n(e)}),{once:!0,passive:!0}),e.addEventListener("error",(()=>{a()}),{once:!0,passive:!0})}),e)}));return this.currentID++,this.promises.push(n),n}))}}(200),v=new a;function g(e){if(s()&&console.log("interpreting link",e),null===e)L("popular"),s()&&y("/r/test/comments/z0yiof/formatting_test/");else{const t=function(e){const t=e.match(/\/?r\/([^/]+?)\/comments\/([^/]+)/);if(s()&&console.log("postMatch",t),null!==t)return L(t[1]),$(),y(e),!0;{const t=e.match(/\/?r\/([^/]+)/);return s()&&console.log("subMatch",t),null!==t&&(L(t[1]),!0)}}(e);!1===t&&L("popular")}}function L(e){!function(){const e=document.querySelector("#posts");null!==e&&(e.innerHTML="")}(),document.createElement("section").classList.add("post"),axios.get(`${r}/r/${e}.json?limit=75`).then((function(e){!function(e){for(let t of e){let e=document.createElement("button");e.classList.add("post");let n=document.createElement("span"),a=t.data.title;n.append(a),e.title=t.data.title,n.classList.add("title");let o=document.createElement("span");o.append(t.data.subreddit_name_prefixed),o.classList.add("subreddit");let s=document.createElement("span");s.innerHTML='<svg width="15" height="15" style="margin-right: 5px;" viewBox="0 0 94 97" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M88.1395 48.8394C84.9395 46.0394 60.4728 18.0061 48.6395 4.33939C46.6395 3.53939 45.1395 4.33939 44.6395 4.83939L4.63948 49.3394C2.1394 53.3394 7.63948 52.8394 9.63948 52.8394H29.1395V88.8394C29.1395 92.0394 32.1395 93.1727 33.6395 93.3394H58.1395C63.3395 93.3394 64.3062 90.3394 64.1395 88.8394V52.3394H87.1395C88.8061 52.0061 91.3395 51.6394 88.1395 48.8394Z" stroke="#818384" stroke-width="7"/></svg>',s.append(`${t.data.score.toLocaleString()}`),s.innerHTML+='<svg width="15" height="15" style="transform: rotate(180deg); margin-left: 5px" viewBox="0 0 94 97" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M88.1395 48.8394C84.9395 46.0394 60.4728 18.0061 48.6395 4.33939C46.6395 3.53939 45.1395 4.33939 44.6395 4.83939L4.63948 49.3394C2.1394 53.3394 7.63948 52.8394 9.63948 52.8394H29.1395V88.8394C29.1395 92.0394 32.1395 93.1727 33.6395 93.3394H58.1395C63.3395 93.3394 64.3062 90.3394 64.1395 88.8394V52.3394H87.1395C88.8061 52.0061 91.3395 51.6394 88.1395 48.8394Z" stroke="#818384" stroke-width="7"/></svg>',s.classList.add("post-data");let i=document.createElement("span");i.classList.add("profile");let d=h[Math.floor(Math.random()*h.length)]+h[Math.floor(Math.random()*h.length)],r=u[Math.floor(Math.random()*u.length)];"#ebe6d1"!==r&&"#ebe6d1"!==r||(i.style.color="black"),i.style.backgroundColor=r,i.append(d),e.append(i,n,o,s),e.addEventListener("click",(()=>{var n;null===(n=document.querySelector(".focused-post"))||void 0===n||n.classList.remove("focused-post"),e.classList.add("focused-post"),E(t.data.permalink),y(t.data.permalink)})),l.append(e)}l.append("That's enough reddit for now. Get back to work!")}(e.data.data.children)})).catch((e=>{console.error(e)}))}function y(e){const t=`${b(new URL(`${r}${e}`))}/.json?limit=75`;return axios.get(t).then((e=>{try{$(),function(e){var t,n,a,o,s;try{d(".reddit-post").scrollTop=0}catch(e){console.error(e)}const i=e.data[1].data.children,l=document.createElement("span");l.append(`Posted by u/${e.data[0].data.children[0].data.author}`),l.classList.add("post-author"),c.append(l);const u=document.createElement("h4"),h=document.createElement("a");u.appendChild(h);const m=e.data[0].data.children[0].data.title;if(h.href=`${r}${e.data[0].data.children[0].data.permalink}`,h.append(m),u.classList.add("post-section-title"),c.append(u),"image"===e.data[0].data.children[0].data.post_hint){let t=document.createElement("img");t.src=e.data[0].data.children[0].data.url_overridden_by_dest,t.classList.add("post-image"),c.append(t)}if(""!==e.data[0].data.children[0].data.selftext&&!e.data[0].data.children[0].data.selftext.includes("preview")){const t=document.createElement("div");t.innerHTML=M(e.data[0].data.children[0].data.selftext_html),t.classList.add("usertext"),c.append(t)}if(!1===e.data[0].data.children[0].data.is_self&&!1===e.data[0].data.children[0].data.is_reddit_media_domain){const t=document.createElement("div"),n=document.createElement("img"),a=document.createElement("a");n.src=e.data[0].data.children[0].data.thumbnail,n.onerror="this.src='https://img.icons8.com/3d-fluency/512/news.png';",a.href=e.data[0].data.children[0].data.url_overridden_by_dest,a.innerText=m,a.target="_blank",a.classList.add("post-link"),t.append(n),t.append(a),t.classList.add("post-link-container"),c.append(t)}const p=null===(s=null===(o=null===(a=null===(n=null===(t=null==e?void 0:e.data[0])||void 0===t?void 0:t.data)||void 0===n?void 0:n.children[0])||void 0===a?void 0:a.data)||void 0===o?void 0:o.secure_media)||void 0===s?void 0:s.reddit_video;if(void 0!==p&&"null"!==p){const t=document.createElement("video");t.classList.add("post-video"),t.setAttribute("controls","");const n=document.createElement("source");n.src=e.data[0].data.children[0].data.secure_media.reddit_video.fallback_url,t.appendChild(n),c.append(t)}const v=function(e){let t=document.createElement("span");t.innerHTML='<svg width="18px" height="18px" style="margin-right: 5px;" viewBox="0 0 94 97" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M88.1395 48.8394C84.9395 46.0394 60.4728 18.0061 48.6395 4.33939C46.6395 3.53939 45.1395 4.33939 44.6395 4.83939L4.63948 49.3394C2.1394 53.3394 7.63948 52.8394 9.63948 52.8394H29.1395V88.8394C29.1395 92.0394 32.1395 93.1727 33.6395 93.3394H58.1395C63.3395 93.3394 64.3062 90.3394 64.1395 88.8394V52.3394H87.1395C88.8061 52.0061 91.3395 51.6394 88.1395 48.8394Z" stroke="#818384" stroke-width="7"/></svg>',t.append(`${e.data[0].data.children[0].data.ups.toLocaleString()}`),t.innerHTML+='<svg width="18px" height="18px" style="transform: rotate(180deg); margin-left: 5px" viewBox="0 0 94 97" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M88.1395 48.8394C84.9395 46.0394 60.4728 18.0061 48.6395 4.33939C46.6395 3.53939 45.1395 4.33939 44.6395 4.83939L4.63948 49.3394C2.1394 53.3394 7.63948 52.8394 9.63948 52.8394H29.1395V88.8394C29.1395 92.0394 32.1395 93.1727 33.6395 93.3394H58.1395C63.3395 93.3394 64.3062 90.3394 64.1395 88.8394V52.3394H87.1395C88.8061 52.0061 91.3395 51.6394 88.1395 48.8394Z" stroke="#818384" stroke-width="7"/></svg>',t.classList.add("post-detail-info");let n=document.createElement("span");n.classList.add("post-detail-info"),n.append(e.data[0].data.children[0].data.subreddit_name_prefixed);let a=document.createElement("span");return a.append(`${e.data[0].data.children[0].data.num_comments.toLocaleString()} Comments`),a.classList.add("post-detail-info"),[t,n,a]}(e);c.append(...v),c.append(document.createElement("hr")),function(e,{post:t}){c.classList.add("post-selected"),c.classList.remove("deselected");const n=f.getFaces().slice(0);x(c,e,{indent:0,ppBuffer:n,post:t})}(i,{post:e.data[0].data.children[0].data.permalink})}(e)}catch(e){console.error(e)}})).catch((e=>{console.error(e)}))}function w(){const e=new URL(document.URL).hash;return""===e?null:e.slice(1)}function b(e){return"/"===e.pathname.substr(-1)?(e.pathname=e.pathname.slice(0,-1),e):e}function E(e,t=!0){const n=b(new URL(document.URL)),a=new URL(`${n.protocol}//${n.hostname}${n.pathname}#${e}`);window.history.pushState({},"",a)}function x(e,t,{post:n,indent:a=0,ppBuffer:o=[]}){if(0!==t.length)for(const i of t)if("t1"===i.kind){const t=i,s=document.createElement("div");a>0&&s.classList.add("replied-comment"),e.appendChild(s),C(t,{ppBuffer:o,domNode:s}),t.data.replies&&x(s,t.data.replies.data.children,{indent:a+10,ppBuffer:o,post:n}),0===a&&e.appendChild(document.createElement("hr"))}else if("more"===i.kind&&void 0!==n){const t=i,d=document.createElement("span");d.classList.add("btn-more");const l=`${r}${n}${t.data.parent_id.slice(3)}`;d.addEventListener("click",(()=>{d.classList.add("waiting"),fetch(`${l}.json`).catch((e=>{d.classList.remove("waiting"),console.error(e)})).then((e=>e.json())).catch((e=>{console.error(e)})).then((t=>{let i;s()&&console.log("Got data!",l,t),d.remove();try{i=t[1].data.children[0].data.replies.data}catch(e){return Promise.reject(e)}return x(e,i.children,{indent:a+10,ppBuffer:o,post:n}),Promise.resolve()}))})),e.appendChild(d)}}function k(e,t=50,n=[]){return o(this,void 0,void 0,(function*(){const a=yield function(){return o(this,void 0,void 0,(function*(){if("gnometalk"===e.data.subreddit)return function(e){return o(this,void 0,void 0,(function*(){const e=document.createElement("img");e.classList.add("gnome");const t=(yield v.random())<=.5?"scaleX(-1) ":"",n=yield v.random(),a=`${t}rotate(${Math.round(40*n-20)}deg) `;e.style.transform=a;const o=yield v.random();return e.style.backgroundColor=u[Math.floor(o*u.length)],e}))}();{const e=(()=>{if(n.length<10)return 0;{const e=.7;return n.length>=25?e:(n.length-10)/15*e}})();return(yield v.random())<e?function(e,t,n=50){return o(this,void 0,void 0,(function*(){const e=Math.round(yield v.random(0,t.length-1)),a=t[e],o=function(e,t){const n=document.createElement("canvas");n.height=n.width=2*t,n.style.height=n.style.width=t.toString();const a=n.getContext("2d");if(null!==a){a.imageSmoothingEnabled=!1,a.imageSmoothingQuality="high";try{a.drawImage(e,0,0,2*t,2*t)}catch(t){console.error(e,t)}return n}return null}(a,n);return i(null!==o,`generateFacePic couldn't get a canvas 2D context from image #${e}, ${a.src} (img.${Array.from(a.classList).join(".")})`),o.classList.add(`human-${e}`),o}))}(0,n):function(e,t){return o(this,void 0,void 0,(function*(){const e=document.createElement("span"),n=yield v.random(0,h.length-1),a=yield v.random(0,h.length-1),o=h[Math.round(n)]+h[Math.round(a)];e.style.padding=`${Math.round(.12*t)}px 3px 3px 3px`,e.style.fontSize=`${Math.round(t/2.08)}px`,e.style.fontWeight="bold",e.style.textAlign="center",e.style.display="inline-block",e.style.cssText+="-webkit-touch-callout: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;";const s=yield v.random(0,u.length-1);return e.style.backgroundColor=u[Math.round(s)],e.textContent=`${o}`,e}))}(0,t)}}))}();return a.classList.add("avatar"),a.style.marginRight="10px",a.classList.contains("avatar-circle")||a.classList.add("avatar-circle"),a}))}function C(e,t={ppBuffer:[]}){return o(this,void 0,void 0,(function*(){void 0===t.domNode&&(t.domNode=document.createElement("div")),t.domNode.id=e.data.id,t.domNode.classList.add("usertext"),t.domNode.classList.add("comment");const n=document.createElement("div");n.classList.add("author"),n.style.display="flex",yield v.setSeed(e.data.author);const a=document.createElement("span");a.style.width=a.style.height="50px",n.appendChild(a),k(e,50,t.ppBuffer).then((e=>{n.replaceChild(e,a)}));let o=document.createElement("div");o.classList.add("author-text"),o.style.display="flex",o.style.flexDirection="column";{let t=document.createElement("span");t.classList.add("username"),t.classList.add("email");const n=(""+e.data.score).length,a=[{n:8,charset:"alpha"},{n:4,charset:"alphanumerical"},{n:4,charset:"alphanumerical"},{n:4,charset:"alphanumerical"},{n:12,charset:"alphanumerical"}];v.randomUUID(a).then((a=>{const o=a.slice(n);t.innerHTML=`${e.data.author} <${e.data.score}${o}@securemail.org>`})),o.append(t);let s=new Date(1e3*e.data.created_utc);const i=document.createElement("span");i.classList.add("comment-posted-date"),i.innerHTML=s.toString().slice(0,21),i.style.color="#a2a2a2",i.style.fontSize="0.85em",o.append(i)}n.append(o);const s=document.createElement("div");return s.insertAdjacentHTML("beforeend",M(e.data.body_html)),t.domNode.prepend(n,s),t.domNode}))}function M(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}function $(){c.innerHTML=""}const S=d("form"),T=d("input"),_=d(".your-subreddits");S.addEventListener("submit",(e=>o(void 0,void 0,void 0,(function*(){e.preventDefault();let t=document.createElement("button");t.classList.add("subreddit","button"),t.id=T.value,t.addEventListener("click",(e=>o(void 0,void 0,void 0,(function*(){$(),s()&&console.log("custom sub click",t.id),E(`/r/${t.id}`),L(t.id)})))),t.append("r/"+T.value),_.append(t),T.value=""}))));const H=document.querySelectorAll(".popular-subreddits>button");for(let e of H)e.addEventListener("click",(t=>o(void 0,void 0,void 0,(function*(){s()&&console.log("default sub click",e.id),E(`/r/${e.id}`),$(),L(e.id)}))));let D=!1;function P(e){return"object"==typeof e&&void 0!==e.style}d(".mark-as-read-btn").addEventListener("click",(()=>{D||(alert("This button literally does nothing"),D=!0)})),d(".inbox-button").addEventListener("click",(()=>o(void 0,void 0,void 0,(function*(){s()&&console.log("inbox click","/r/popular"),E("/r/popular"),$(),L("popular")}))));let R=document.querySelectorAll(".collapsible");for(let e of R)e.addEventListener("click",(function(){var e;let t=null==this?void 0:this.nextElementSibling;if(!P(t))return;let n=null===(e=null==this?void 0:this.firstChild)||void 0===e?void 0:e.nextSibling;P(n)&&("none"===t.style.display?(n.classList.remove("ms-Icon--ChevronRight"),n.classList.add("ms-Icon--ChevronDownMed"),t.style.display="block"):(n.classList.remove("ms-Icon--ChevronDownMed"),n.classList.add("ms-Icon--ChevronRight"),t.style.display="none"))}));const U=d(".post-sidebar");let B;function I(e){const t=B-e.x;B=e.x,U.style.width=`${parseInt(getComputedStyle(U,"").width)+t}px`}U.addEventListener("mousedown",(function(e){e.offsetX<4&&(B=e.x,document.addEventListener("mousemove",I,!1))}),!1),document.addEventListener("mouseup",(function(){document.removeEventListener("mousemove",I,!1)}),!1);let j=d(".settings-button"),A=d(".settings-panel");j.addEventListener("click",(()=>{q.classList.remove("profile-panel-show"),A.classList.toggle("settings-panel-show")})),d(".close-settings").addEventListener("click",(()=>{A.classList.remove("settings-panel-show")}));const N=d("#flexSwitchCheckChecked");N.addEventListener("change",(function(){const e=d("body");N.checked?(e.classList.remove("light"),e.classList.add("dark")):(e.classList.remove("dark"),e.classList.add("light"))})),window.addEventListener("hashchange",(()=>{$();const e=w();s()&&console.log("history buttons clicked",e),g(e)}));let V=d(".profile-button"),q=d(".profile-panel");if(V.addEventListener("click",(()=>{A.classList.remove("settings-panel-show"),q.classList.toggle("profile-panel-show")})),s()){const e=document.getElementById("loadingScreen");e&&(e.style.display="none")}g(w())})();
